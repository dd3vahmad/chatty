---
import AppLayout from '@/layouts/AppLayout.astro';
import { Icon } from 'astro-icon/components';
import Base from '@/components/base.astro';
import Search from '@/components/search.astro';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/starwind/avatar';

const chats = [
  { id: 1,
    pic: "https://api.dicebear.com/9.x/adventurer/svg?seed=Vivian&backgroundClor=b6e3f4,c0aede,d1d4f9,ffd5dc,ffdfbf",
    name: "John Doe", 
    lastMessage: "Hey, how are you?, How as your holiday been, hope all is well if so to God be the glory!", 
    time: "10:30", 
    lastMessageStatus: "unread",
    isOnline: true
  },
  { 
    id: 2, 
    pic: "https://api.dicebear.com/9.x/adventurer/svg?seed=Maria&backgroundColor=b6e3f4,c0aede,d1d4f9,ffd5dc,ffdfbf", 
    name: "Bob Brown", 
    lastMessage: "Thanks for the update.", 
    time: "29/08/25", 
    lastMessageStatus:"read" ,
    isOnline: false

  },
  { 
    id: 3, 
    pic: "https://api.dicebear.com/9.x/adventurer/svg?seed=Jude&backgroundColor=b6e3f4,c0aede,d1d4f9,ffd5dc,ffdfbf",
    name: "Bob Blue", 
    lastMessage: "Thanks for the drink. It was really nice.", 
    time: "29/08/25", 
    lastMessageStatus:"read",
    isOnline: true
  },
  { 
    id: 4, 
    pic: "https://api.dicebear.com/9.x/adventurer/svg?seed=Aidan&backgroundColor=b6e3f4,c0aede,d1d4f9,ffd5dc,ffdfbf", 
    name: "Jane Smith", 
    lastMessage: "Let's catch up later!", 
    time: "09:15", 
    lastMessageStatus: "sent",
    isOnline: true 
  },
  { 
    id: 5, 
    pic: "https://api.dicebear.com/9.x/adventurer/svg?seed=Luis&backgroundColor=b6e3f4,c0aede,d1d4f9,ffd5dc,ffdfbf", 
    name: "Alice Johnson", 
    lastMessage: "See you soon!", 
    time: "Yesterday", 
    lastMessageStatus: "received",
    isOnline: false 
  },
  { 
    id: 6, 
    pic: "https://api.dicebear.com/9.x/adventurer/svg?seed=Caleb&backgroundColor=b6e3f4,c0aede,d1d4f9,ffd5dc,ffdfbf", 
    name: "Mary Doe", 
    lastMessage: "Hey, how are you?", 
    time: "10:30", 
    lastMessageStatus: "unread",
    isOnline: true 
  },
  { 
    id: 7, 
    pic: "https://api.dicebear.com/9.x/adventurer/svg?seed=Christian&backgroundColor=b6e3f4,c0aede,d1d4f9,ffd5dc,ffdfbf", 
    name: "Jane White", 
    lastMessage: "Let's catch up later!", 
    time: "09:15", 
    lastMessageStatus: "sent",
    isOnline: false 
  },
  { 
    id: 8, 
    pic: "https://api.dicebear.com/9.x/adventurer/svg?seed=Kingston&backgroundColor=b6e3f4,c0aede,d1d4f9,ffd5dc,ffdfbf", 
    name: "Alexander Berry", 
    lastMessage: "See you at the bar, come loaded!", 
    time: "Yesterday", 
    lastMessageStatus: "received", isOnline: true 
  },
  { 
    id: 9, 
    pic: "https://api.dicebear.com/9.x/adventurer/svg?seed=Nolan&backgroundColor=b6e3f4,c0aede,d1d4f9,ffd5dc,ffdfbf", 
    name: "Nolan Brown", 
    lastMessage: "Thanks for the update.", 
    time: "29/08/25", 
    lastMessageStatus:"read",
    isOnline: false 
  },
  { 
    id: 10, 
    pic: "https://api.dicebear.com/9.x/adventurer/svg?seed=Amaya&backgroundColor=b6e3f4,c0aede,d1d4f9,ffd5dc,ffdfbf", 
    name: "Amaya Christian", 
    lastMessage: "Thanks for the update.", 
    time: "29/08/25", 
    lastMessageStatus:"read",
    isOnline: false 
  },
];
---

<AppLayout title="Chats">
  <div class="flex justify-between items-center px-3 py-4">
    <h1 class="text-2xl font-bold text-orange-500">Chatty</h1>

    <div class="flex items-center gap-2">
      <Avatar size='lg' class={"border-0"}>
        <AvatarImage 
          src='https://api.dicebear.com/9.x/adventurer/svg?seed=Amaya&backgroundColor=b6e3f4,c0aede,d1d4f9,ffd5dc,ffdfbf' 
          alt={`Profile picture`} 
        />
        <AvatarFallback class="flex justify-center font-semibold text-sm text-gray-500">
          N/A
        </AvatarFallback>
      </Avatar>
    </div>
  </div>
  <Search />
  <div class="max-w-[400px] mx-auto my-0">
    {chats.map(chat => {
      const names = chat.name.split(" ");
      const firstname = names[0];
      const secondname = names.length >= 2 ? names[1] : "";
      const initials = secondname ? firstname[0] + secondname[0] : firstname ? firstname[0] : "N/A"

      return (
        <div class="hover:bg-slate-50 flex items-center gap-3 px-4 transition-colors duration-200 cursor-pointer">
          <div class="relative w-12 h-12">
            <Avatar size='lg' class={"border-0 z-0"}>
              <AvatarImage 
                src={chat.pic}
                alt={chat.name} 
              />
              <AvatarFallback class="flex justify-center font-semibold text-sm text-gray-500">
                {initials}
              </AvatarFallback>
            </Avatar>
            <div hidden={!chat.isOnline} class="w-2.5 h-2.5 bg-green-500 rounded-full absolute bottom-1 right-0"></div>
          </div>
          <div class="flex-1 flex items-center justify-between">
            <div class="flex-1 flex flex-col py-4">
              <span class="font-bold text-sm mb-1">{chat.name}</span>
              <span class={`text-xs truncate max-w-[65vw] ${chat.lastMessageStatus === "unread" && "font-semibold"}`}>{chat.lastMessage}</span>
            </div>

            <div class="flex flex-col gap-y-2 items-end">
              <span class="text-xs font-semibold text-gray-500">{chat.time}</span>
              <div class="text-xs w-4 h-4">
              <span hidden={chat.lastMessageStatus !== "unread"} class="rounded-full bg-orange-500 flex items-center justify-center text-white shadow-lg shadow-orange-300">
                2
              </span>
              <span hidden={chat.lastMessageStatus !== "sent" && chat.lastMessageStatus !== "received"}>
                <Icon name={chat.lastMessageStatus === "sent" ? "check" : chat.lastMessageStatus === "received" ? "check-double" : "check"} size={"20px"} class="text-gray-500" />
              </span>
              <span hidden={chat.lastMessageStatus !== "read"}>
                <Icon name={"check-double"} size={"20px"} class="text-orange-600" />
              </span>
              </div>
            </div>
          </div>
        </div>
      )
    })}
  </div>
  <Icon name={"chat-add"} size={"50px"} class="text-white bg-orange-500 cursor-pointer shadow-2xl shadow-amber-600 fixed bottom-10 right-4 p-3 rounded-lg" />
  <Base />
</AppLayout>